<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    {% load staticfiles %}

    <link href="{% static 'bootstrap/dist/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/home.css' %}" rel="stylesheet">
    <script src="{% static 'jquery/dist/jquery.min.js' %}"></script> 
    <script src="{% static 'bootstrap/dist/js/bootstrap.min.js' %}"></script>

    <script type="text/javascript"> 
        $(document).ready(function() {
            /* ------------------------------ images uploading -------------------------------- */
            var profileImg = '';
            var reader;

            function handleFileSelect(evt) {
                files = evt.target.files;

                // limit the file number
                if (files.length > 1) {
                    alert("only 1 profile image is allowed");
                    return;
                }

                // decide whether file list block should be displayed
                if(!files[0].type.match('image.*')) {
                    alert("This is not an image file");
                    return;
                }

                for (var i = 0, f; f = files[i]; i++) {
                    if(!f.type.match('image.*')){
                        continue;
                    }
                    reader = new FileReader();
                    reader.onload = (function(theFile){
                        return function(e){
                            var imgProfile = document.getElementById('profileImg');
                            imgProfile.setAttribute('src', e.target.result);
                            imgProfile.onload = function() {
                                profileImg = e.target.result;
                            }
                        }
                    })(f);
                    reader.readAsDataURL(f);
                }
            }
            document.getElementById('fileframe').addEventListener('change', handleFileSelect, false);

            /* form submit */
            $("#group_upload").submit(function(event){
                event.preventDefault();

                var imj = {file:profileImg};
                var token = $('input[name="csrfmiddlewaretoken"]').prop('value');
                imj["csrfmiddlewaretoken"] = token;
                $.post("/fileupload", imj, function(feedback){
                    if (feedback.status == 0) {
                        // construct the JSON
                        var group_obj = {};
                        group_obj["name"] = $("#name").val();
                        group_obj["description"] = $("#description").val();
                        group_obj["proPic"] = feedback.hash;
                        group_obj["csrfmiddlewaretoken"] = token;

                        // post the JSON
                        $.post("/group/new", group_obj, function(res) {
                            console.log(res);
                        });
                    }
                    else {
                        alert("Group Profile upload failed!");
                    }
                });
            });

        });
    </script>
</head>

<body>
    <div align="center">
        <img src="{% static 'img/LOGO.png' %}" class="logo">
        <!--img src="./img/LOGO.png" class="logo"-->
        <h3>Upload a New Song</h3>

    </div>

    <div class="container">
        <form id="group_upload">
            {% csrf_token %}
            <div class="form-group">
                <label for="group">Group name : <font color=#337ab7 >Country</font></label>
            </div>

            <div class="form-group">
                <label for="uploader">Uploader : <font color=#337ab7 >Sei</font></label>
            </div>

            <div class="form-group">
                <label for="name">Song name :</label>
                <input type="text" class="form-control" id="name">
            </div>

            <div class="form-group">
                <label for="artist">Artist :</label>
                <input type="text" class="form-control" id="artist">
            </div>

            <div class="form-group">
                <label for="artist">Song file</label>
                <input class='fileframe' id='fileframe' type="file" title=" ">
            </div>

            <button type="submit" form="group_upload" class="btn btn-primary" id="submit">Submit</button>
        </form>
    </div> <!-- /container -->

</body></html>
